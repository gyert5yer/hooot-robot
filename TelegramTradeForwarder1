import asyncio
from telethon import TelegramClient, events
from telethon.errors import SessionPasswordNeededError
from datetime import datetime
import random

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø³Ø§Ø¨ ØªÙ„ÙŠØ¬Ø±Ø§Ù…
api_id = 18439801
api_hash = '404b3d2a988df2f79939ea0ce63eaad0'
session_name = 'session_name'

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ù†ÙˆØ§Øª
source_channel = 'https://t.me/+uEZERfS4hJoxYjA0'  # Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙˆØµÙŠØ§Øª
target_channel = '@COPY_SIGN11'  # Ù‚Ù†Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©

# Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ© Ø§Ù„Ù…Ø±ÙÙ‚Ø© Ù…Ø¹ ÙƒÙ„ ØªÙˆØµÙŠØ©
image_path = 'photo.jpg'

# ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„
client = TelegramClient(session_name, api_id, api_hash)

# Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªÙˆØµÙŠØ§Øª
async def forward_message(event):
    message = event.raw_text

    if "put" in message.lower() or "call" in message.lower():
        try:
            lines = message.splitlines()

            pair = lines[0].replace("ğŸ’³", "").strip()
            raw_time_24 = lines[2].replace("âŒ›", "").strip()
            raw_direction = lines[3].lower()

            if "put" in raw_direction:
                direction = "Down"
            elif "call" in raw_direction:
                direction = "Up"
            else:
                direction = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"

            random_profit = f"{random.randint(90, 99)}%"

            formatted_message = f"""
ğŸ“‰ Ø§Ø³Ù… Ø§Ù„Ù€Ù€Ø²ÙˆØ¬  : {pair}
ğŸ¯ ØªÙˆÙ‚ÙŠÙ€Ù€Ù€Øª Ø§Ù„Ø¯Ø®Ù€Ù€ÙˆÙ„ : {raw_time_24}
â†•ï¸ Ø§ØªØ¬Ù€Ù€Ø§Ù‡ Ø§Ù„ØµÙÙ‚Ù€Ù€Ù€Ù€Ù‡ : {direction}
ğŸ•’ Ù…Ù€Ù€Ø¯Ù‡ Ø§Ù„ØµÙÙ‚Ù€Ù€Ù€Ù‡ : 2MIN

â€¢ Ù†Ø³Ø¨Ù‡ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© {random_profit} â‡ï¸
â€¢ Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ @ALPASHMO7ASB âš¡ï¸
            """.strip()

            await client.send_file(
                target_channel,
                file=image_path,
                caption=formatted_message
            )
            print(f"âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙˆØµÙŠØ©: {pair} - {direction} - {raw_time_24} - {random_profit}")
        except Exception as e:
            print("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ†Ø³ÙŠÙ‚ Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆØµÙŠØ©:", e)

    elif "win" in message.lower():
        try:
            await client.send_message(target_channel, "ğŸ“Š Ù†ØªÙŠØ¬Ù‡ Ø§Ù„ØµÙÙ‚Ù‡ :\nâœ… Ø§Ù†ØªÙ‡Ù€Øª Ø§Ù„ØµÙ€ÙÙ‚Ù‡ Ø¨Ù€Ù€Ø±Ø¨Ø­ âœ…")
            with open("results.txt", "a", encoding="utf-8") as file:
                file.write("WIN âœ… - " + str(datetime.now()) + "\n")
        except Exception as e:
            print("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ù†ØªÙŠØ¬Ø© WIN:", e)

    elif "loss" in message.lower():
        try:
            await client.send_message(target_channel, "ğŸ“Š Ù†ØªÙŠØ¬Ù‡ Ø§Ù„ØµÙÙ‚Ù‡ :\nâ Ø§Ù†ØªÙ‡Ù€Øª Ø§Ù„ØµÙ€ÙÙ‚Ù‡ Ø¨Ø®Ø³Ù€Ù€Ù€Ø§Ø±Ù‡ â")
            with open("results.txt", "a", encoding="utf-8") as file:
                file.write("LOSS â - " + str(datetime.now()) + "\n")
        except Exception as e:
            print("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ù†ØªÙŠØ¬Ø© LOSS:", e)

# Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª
async def main():
    await client.start()
    print("ğŸš€ Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¹Ø©...")

    if not await client.is_user_authorized():
        await client.send_code_request(input("ğŸ“± Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ: "))
        try:
            await client.sign_in(code=input("ğŸ“© Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: "))
        except SessionPasswordNeededError:
            await client.sign_in(password=input("ğŸ” Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (2FA): "))

    @client.on(events.NewMessage(chats=source_channel))
    async def handler(event):
        await forward_message(event)

    await client.run_until_disconnected()

if __name__ == '__main__':
    asyncio.run(main())
